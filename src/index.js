// const { categories } = require('./cards.js');
// const { cards } = require('./cards.js');
const categories = ['Animals', 'Action', 'Actions Part 2', 'Actions Part 3', 'Animals Part 2', 'Animals Part 3', 'Clothes', 'Emotion'];
const cards = [
    [
        {
            word: 'koala',
            translation: 'коала',
            image: './src/img/koala.jpg',
            audioSrc: './src/audio/koala.mp3',
        },
        {
            word: 'butterfly',
            translation: 'бабочка',
            image: './src/img/butterfly.jpg',
            audioSrc: './src/audio/butterfly.mp3',
        },
        {
            word: 'snake',
            translation: 'змея',
            image: './src/img/snake.jpg',
            audioSrc: './src/audio/snake.mp3',
        },
        {
            word: 'bear',
            translation: 'медведь',
            image: './src/img/bear.jpg',
            audioSrc: './src/audio/bear.mp3',
        },
        {
            word: 'cow',
            translation: 'корова',
            image: './src/img/cow.jpg',
            audioSrc: './src/audio/cow.mp3',
        },
        {
            word: 'elephant',
            translation: 'слон',
            image: './src/img/elephant.jpg',
            audioSrc: './src/audio/elephant.mp3',
        },
        {
            word: 'fox',
            translation: 'лиса',
            image: './src/img/fox.jpg',
            audioSrc: './src/audio/fox.mp3',
        },
        {
            word: 'shark',
            translation: 'акула',
            image: './src/img/shark.jpg',
            audioSrc: './src/audio/shark.mp3',
        },
    ],
    [
        {
            word: 'cook',
            translation: 'готовить',
            image: './src/img/cook.jpg',
            audioSrc: './src/audio/cook.mp3',
        },
        {
            word: 'drink',
            translation: 'пить',
            image: './src/img/drink.jpg',
            audioSrc: './src/audio/drink.mp3',
        },
        {
            word: 'eat',
            translation: 'есть',
            image: './src/img/eat.jpg',
            audioSrc: './src/audio/eat.mp3',
        },
        {
            word: 'cycling',
            translation: 'ездить на велосипеде',
            image: './src/img/cycling.jpg',
            audioSrc: './src/audio/cycling.mp3',
        },
        {
            word: 'rollerblade',
            translation: 'кататься на роликах',
            image: './src/img/rollerblade.jpg',
            audioSrc: './src/audio/rollerblade.mp3',
        },
        {
            word: 'ski',
            translation: 'Кататься на лыжах',
            image: './src/img/ski.jpg',
            audioSrc: './src/audio/ski.mp3',
        },
        {
            word: 'sleep',
            translation: 'спать',
            image: './src/img/sleep.jpeg',
            audioSrc: './src/audio/sleep.mp3',
        },
        {
            word: 'study',
            translation: 'учиться',
            image: './src/img/study.jpg',
            audioSrc: './src/audio/study.mp3',
        },
    ],
    [
        {
            word: 'cry',
            translation: 'плакать',
            image: './src/img/cry.jpg',
            audioSrc: './src/audio/cry.mp3',
        },
        {
            word: 'dance',
            translation: 'танцевать',
            image: './src/img/dance.jpg',
            audioSrc: './src/audio/dance.mp3',
        },
        {
            word: 'dive',
            translation: 'нырять',
            image: './src/img/dive.jpg',
            audioSrc: './src/audio/dive.mp3',
        },
        {
            word: 'draw',
            translation: 'рисовать',
            image: './src/img/draw.jpg',
            audioSrc: './src/audio/draw.mp3',
        },
        {
            word: 'fish',
            translation: 'ловить рыбу',
            image: './src/img/fish.jpg',
            audioSrc: './src/audio/fish.mp3',
        },
        {
            word: 'fly',
            translation: 'летать',
            image: './src/img/fly.jpg',
            audioSrc: './src/audio/fly.mp3',
        },
        {
            word: 'hug',
            translation: 'обнимать',
            image: './src/img/hug.jpg',
            audioSrc: './src/audio/hug.mp3',
        },
        {
            word: 'jump',
            translation: 'прыгать',
            image: './src/img/jump.jpg',
            audioSrc: './src/audio/jump.mp3',
        },
    ],
    [
        {
            word: 'open',
            translation: 'открывать',
            image: './src/img/open.jpg',
            audioSrc: './src/audio/open.mp3',
        },
        {
            word: 'play',
            translation: 'играть',
            image: './src/img/play.jpg',
            audioSrc: './src/audio/play.mp3',
        },
        {
            word: 'point',
            translation: 'указывать',
            image: './src/img/point.jpg',
            audioSrc: './src/audio/point.mp3',
        },
        {
            word: 'ride',
            translation: 'ездить',
            image: './src/img/ride.jpg',
            audioSrc: './src/audio/ride.mp3',
        },
        {
            word: 'run',
            translation: 'бегать',
            image: './src/img/run.jpg',
            audioSrc: './src/audio/run.mp3',
        },
        {
            word: 'sing',
            translation: 'петь',
            image: './src/img/sing.jpg',
            audioSrc: './src/audio/sing.mp3',
        },
        {
            word: 'skip',
            translation: 'пропускать, прыгать',
            image: './src/img/skip.jpg',
            audioSrc: './src/audio/skip.mp3',
        },
        {
            word: 'swim',
            translation: 'плавать',
            image: './src/img/swim.jpg',
            audioSrc: './src/audio/swim.mp3',
        },
    ],
    [
        {
            word: 'cat',
            translation: 'кот',
            image: './src/img/cat.jpg',
            audioSrc: './src/audio/cat.mp3',
        },
        {
            word: 'chick',
            translation: 'цыплёнок',
            image: './src/img/chick.jpg',
            audioSrc: './src/audio/chick.mp3',
        },
        {
            word: 'chicken',
            translation: 'курица',
            image: './src/img/chicken.jpg',
            audioSrc: './src/audio/chicken.mp3',
        },
        {
            word: 'dog',
            translation: 'собака',
            image: './src/img/dog.jpg',
            audioSrc: './src/audio/dog.mp3',
        },
        {
            word: 'horse',
            translation: 'лошадь',
            image: './src/img/horse.jpg',
            audioSrc: './src/audio/horse.mp3',
        },
        {
            word: 'pig',
            translation: 'свинья',
            image: './src/img/pig.jpg',
            audioSrc: './src/audio/pig.mp3',
        },
        {
            word: 'rabbit',
            translation: 'кролик',
            image: './src/img/rabbit.jpg',
            audioSrc: './src/audio/rabbit.mp3',
        },
        {
            word: 'sheep',
            translation: 'овца',
            image: './src/img/sheep.jpg',
            audioSrc: './src/audio/sheep.mp3',
        },
    ],
    [
        {
            word: 'bird',
            translation: 'птица',
            image: './src/img/bird.jpg',
            audioSrc: './src/audio/bird.mp3',
        },
        {
            word: 'fish',
            translation: 'рыба',
            image: './src/img/fish1.jpg',
            audioSrc: './src/audio/fish.mp3',
        },
        {
            word: 'frog',
            translation: 'жаба',
            image: './src/img/frog.jpg',
            audioSrc: './src/audio/frog.mp3',
        },
        {
            word: 'giraffe',
            translation: 'жирафа',
            image: './src/img/giraffe.jpg',
            audioSrc: './src/audio/giraffe.mp3',
        },
        {
            word: 'lion',
            translation: 'лев',
            image: './src/img/lion.jpg',
            audioSrc: './src/audio/lion.mp3',
        },
        {
            word: 'mouse',
            translation: 'мышь',
            image: './src/img/mouse.jpg',
            audioSrc: './src/audio/mouse.mp3',
        },
        {
            word: 'turtle',
            translation: 'черепаха',
            image: './src/img/turtle.jpg',
            audioSrc: './src/audio/turtle.mp3',
        },
        {
            word: 'dolphin',
            translation: 'дельфин',
            image: './src/img/dolphin.jpg',
            audioSrc: './src/audio/dolphin.mp3',
        },
    ],
    [
        {
            word: 'skirt',
            translation: 'юбка',
            image: './src/img/skirt.jpg',
            audioSrc: './src/audio/skirt.mp3',
        },
        {
            word: 'pants',
            translation: 'брюки',
            image: './src/img/pants.jpg',
            audioSrc: './src/audio/pants.mp3',
        },
        {
            word: 'blouse',
            translation: 'блузка',
            image: './src/img/blouse.jpg',
            audioSrc: './src/audio/blouse.mp3',
        },
        {
            word: 'dress',
            translation: 'платье',
            image: './src/img/dress.jpg',
            audioSrc: './src/audio/dress.mp3',
        },
        {
            word: 'boot',
            translation: 'ботинок',
            image: './src/img/boot.jpg',
            audioSrc: './src/audio/boot.mp3',
        },
        {
            word: 'shirt',
            translation: 'рубашка',
            image: './src/img/shirt.jpg',
            audioSrc: './src/audio/shirt.mp3',
        },
        {
            word: 'coat',
            translation: 'пальто',
            image: './src/img/coat.jpg',
            audioSrc: './src/audio/coat.mp3',
        },
        {
            word: 'shoe',
            translation: 'туфли',
            image: './src/img/shoe.jpg',
            audioSrc: './src/audio/shoe.mp3',
        },
    ],
    [
        {
            word: 'sad',
            translation: 'грустный',
            image: './src/img/sad.jpg',
            audioSrc: './src/audio/sad.mp3',
        },
        {
            word: 'angry',
            translation: 'сердитый',
            image: './src/img/angry.jpg',
            audioSrc: './src/audio/angry.mp3',
        },
        {
            word: 'happy',
            translation: 'счастливый',
            image: './src/img/happy.jpg',
            audioSrc: './src/audio/happy.mp3',
        },
        {
            word: 'tired',
            translation: 'уставший',
            image: './src/img/tired.jpg',
            audioSrc: './src/audio/tired.mp3',
        },
        {
            word: 'surprised',
            translation: 'удивлённый',
            image: './src/img/surprised.jpg',
            audioSrc: './src/audio/surprised.mp3',
        },
        {
            word: 'scared',
            translation: 'испуганный',
            image: './src/img/scared.jpg',
            audioSrc: './src/audio/scared.mp3',
        },
        {
            word: 'smile',
            translation: 'улыбка',
            image: './src/img/smile.jpg',
            audioSrc: './src/audio/smile.mp3',
        },
        {
            word: 'laugh',
            translation: 'смех',
            image: './src/img/laugh.jpg',
            audioSrc: './src/audio/laugh.mp3',
        },
    ],
];
const hamburger = document.querySelector('.hamburger');
const checkbox = document.getElementById('d');
const mainMenu = document.querySelector('.categories-menu').innerHTML;
const gameButton = document.querySelector('.new-game-container');
const navigation = document.querySelector('.navigation');
const elementOfCategory = document.querySelectorAll('.categories-menu__element');

let gameMode = false;
let onScreen = true;
let newArray;
let array;
let errors = 0;
let byElementGrowth = true;

function clearWindow() {
    const images = document.querySelectorAll('.active-card');
    const starsContainer = document.querySelectorAll('.rating-menu');
    const finishFailContainer = document.querySelector('.finish_container__failure').children[0];
    if (finishFailContainer.firstChild.innerHTML !== 'Mistakes') {
        finishFailContainer.removeChild(finishFailContainer.firstChild);
    }
    gameButton.children[0].innerHTML = 'Start game';
    gameButton.children[0].classList.remove('new-game-container__repeat-button');
    if (gameButton.children[1]) {
        gameButton.removeChild(gameButton.children[1]);
    }
    images.forEach((element) => {
        element.dataset.active = 'no';
        element.classList.remove('active-card');
    });
    starsContainer.forEach((elem) => {
        while (elem.firstChild) {
            elem.removeChild(elem.firstChild);
        }
    });
    onScreen = true;
    errors = 0;
}

function getRandomInt() {
    if (onScreen) {
        array = [0, 1, 2, 3, 4, 5, 6, 7];
        const rand = Math.floor(Math.random() * array.length);
        const temp = array[rand];
        array.splice(rand, 1);
        newArray = array;
        onScreen = !onScreen;
        return temp;
    }
    array = newArray;
    const rand = Math.floor(Math.random() * array.length);
    const temp = array[rand];
    array.splice(rand, 1);
    newArray = array;
    return temp;
}

function hideNavigationBar() {
    navigation.classList.remove('active');
}

function sortTable(index) {
    const table = document.querySelector('table');
    const sortedRows = Array.from(table.rows).slice(1);
    if (byElementGrowth) {
            sortedRows.sort((rowA, rowB) => (rowA.cells[index].innerHTML < rowB.cells[index].innerHTML ? 1 : -1));
    } else {
            sortedRows.sort((rowA, rowB) => (rowA.cells[index].innerHTML > rowB.cells[index].innerHTML ? 1 : -1));
    }
    table.tBodies[0].append(...sortedRows);
    byElementGrowth = !byElementGrowth;
}

function goToMainMenu() {
    if (!gameMode) {
        document.querySelector('.categories-menu').innerHTML = mainMenu;
    } else {
        gameButton.classList.remove('active-game');
        document.querySelector('.categories-menu').innerHTML = mainMenu;
        document.querySelectorAll('.card-body').forEach((item) => {
            item.classList.toggle('green_color');
        });
    }
}

document.addEventListener('click', (event) => {
    const targetElement = event.target;
    const indexOfCategory = categories.indexOf(`${targetElement.dataset.id}`);

    function createStatistics(errorType) {
        const identifier = targetElement.parentNode.parentNode.children[1].children[1].innerHTML;
        if (localStorage.getItem(`${errorType}_${identifier}`)) {
            let temp = localStorage.getItem(`${errorType}_${identifier}`);
            temp = +temp + 1;
            localStorage.setItem(`${errorType}_${identifier}`, `${temp}`);
        } else {
            localStorage.setItem(`${errorType}_${identifier}`, '1');
        }
    }

    function isTrue(expression) {
        const isNumber = (value) => !Number.isNaN(value);
        if (isNumber(expression) && expression !== null) {
            return expression;
        }
        return '0';
    }

    if (targetElement === hamburger || targetElement.parentNode === hamburger) {
        hamburger.classList.toggle('hamburger_active');
        navigation.classList.toggle('active');
    } else if (navigation.classList.contains('active')) {
        hideNavigationBar();
        hamburger.classList.toggle('hamburger_active');
    }
    if (targetElement === checkbox) {
        gameMode = !gameMode;
        document.querySelectorAll('.card').forEach((item) => {
            item.children.item(2).classList.toggle('green_color');
        });
        navigation.classList.toggle('green_color');
        document.querySelectorAll('.flip-card-front').forEach((element) => {
            element.children.item(1).classList.toggle('hidden');
        });
        if (document.querySelector('.flip-card')) {
            gameButton.classList.toggle('active-game');
        }
        if (!gameMode) {
            clearWindow();
        }
    }
    if (targetElement.classList.contains('navigation__list_item')) {
        document.querySelectorAll('.navigation__list_item').forEach((element) => {
            element.classList.remove('active_link');
        });
        targetElement.classList.add('active_link');
        clearWindow();
    }
    if ((targetElement.classList.contains('mask') || targetElement.classList.contains('navigation__list_item'))
        && (targetElement.innerText !== 'Main Menu' && targetElement.innerText !== 'Statistics')) {
        while (document.querySelector('.categories-menu').firstChild) {
            document.querySelector('.categories-menu').removeChild(document.querySelector('.categories-menu').firstChild);
        }
        for (let i = 0; i < 8; i += 1) {
            const newEl = document.createElement('div');
            newEl.classList.add('categories-menu__element');
            newEl.innerHTML = ` <div class="flip-card ">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="view overlay">
                            <audio data-sound="${[i]}" src="${cards[indexOfCategory][i].audioSrc}"></audio>
                            <img class="card-img-top" 
                                 data-active="no" 
                                 data-name="card" 
                                 data-id="${targetElement.dataset.id}" 
                                 src="${cards[indexOfCategory][i].image}" 
                                 alt="Card image cap">
                                <a>          
                                    <div class="rgba-white-slight"></div>
                                </a>
                            </div>
                            <div class="card-body black-color white-text rounded-bottom">
                                <a class="activator waves-effect mr-4"><i class="fas fa-share-alt white-text"></i></a>
                                <h4 class="card-title">${cards[indexOfCategory][i].word}</h4>
                                <img class="turn-card" src="./src/img/rotate.svg" data-id="swap" alt="swap">
                            </div>
                        </div>
                        <div class="flip-card-back">
                            <div class="view overlay">
                                <img class="card-img-top"  data-id="card" src="${cards[indexOfCategory][i].image}" alt="Card image cap">
                                <a>          
                                    <div class="rgba-white-slight"></div>
                                </a>
                            </div>
                            <div class="card-body black-color white-text rounded-bottom">
                                <a class="activator waves-effect mr-4"><i class="fas fa-share-alt white-text"></i></a>
                                <h4 class="card-title">${cards[indexOfCategory][i].translation}</h4>
                            </div>
                        </div>
                    </div>
                    </div>`;
            document.querySelector('.categories-menu').appendChild(newEl);
        }
        if (gameMode) {
            onScreen = true;
            gameButton.children[0].classList.remove('new-game-container__repeat-button');
            gameButton.children[0].innerHTML = 'Start game';
            gameButton.classList.add('active-game');
            document.querySelectorAll('.flip-card-front').forEach((element) => {
                element.children.item(1).classList.add('hidden');
            });
        }
        gameButton.children[0].setAttribute('data-id', `${targetElement.dataset.id}`);
    }
    if (targetElement.innerText === 'Main Menu') {
        goToMainMenu();
    }
    if (targetElement.innerText === 'Statistics') {
        elementOfCategory.forEach(() => {
            while (document.querySelector('.categories-menu').firstChild) {
                document.querySelector('.categories-menu').removeChild(document.querySelector('.categories-menu').firstChild);
            }
        });
        document.querySelector('.categories-menu').innerHTML = '<table class="table table-hover mb-0" >\n'
            + '  <thead class="grey lighten-2">\n'
            + '    <tr>\n'
            + '      <th data-id="Category">Category ↕</th>\n'
            + '      <th data-id="Word">Word ↕</th>\n'
            + '      <th data-id="Translation">Translation ↕</th>\n'
            + '      <th data-id="Train">Train ↕</th>\n'
            + '      <th data-id="Correct">Correct ↕</th>\n'
            + '      <th data-id="Wrong">Wrong ↕</th>\n'
            + '      <th data-id="Wrong %">Wrong % ↕</th>\n'
            + '    </tr>\n'
            + '  </thead>\n'
            + '  <tbody class="table_body">\n'
            + '  </tbody>\n'
            + '</table>';
        for (let i = 0; i < 8; i += 1) {
            for (let j = 0; j < 8; j += 1) {
                const tr = document.createElement('tr');
                const errorValue = localStorage.getItem(`game-error_${cards[j][i].word}`);
                const successValue = localStorage.getItem(`game-success_${cards[j][i].word}`);
                let percentOfError;
                if (+successValue + +errorValue !== 0) {
                    percentOfError = (+errorValue * 100) / (+successValue + +errorValue);
                } else {
                    percentOfError = 0;
                }
                tr.innerHTML = `
                <td>${categories[j]}</td>
                <td>${cards[j][i].word}</td>
                <td>${cards[j][i].translation}</td>
                <td>${isTrue(localStorage.getItem(`train_${cards[j][i].word}`))}</td>
                <td>${isTrue(localStorage.getItem(`game-success_${cards[j][i].word}`))}</td>
                <td>${isTrue(localStorage.getItem(`game-error_${cards[j][i].word}`))}</td>
                <td>${isTrue(`${Math.round(percentOfError)}`)}</td>`;
                document.querySelector('.table_body').appendChild(tr);
            }
        }
    }
    if (targetElement.dataset.id === 'Category') {
        sortTable(0);
    } else if (targetElement.dataset.id === 'Word') {
        sortTable(1);
    } else if (targetElement.dataset.id === 'Translation') {
        sortTable(2);
    } else if (targetElement.dataset.id === 'Train') {
        sortTable(3);
    } else if (targetElement.dataset.id === 'Correct') {
        sortTable(4);
    } else if (targetElement.dataset.id === 'Wrong') {
        sortTable(5);
    } else if (targetElement.dataset.id === 'Wrong %') {
        sortTable(6);
    }

    if (targetElement.dataset.id === 'swap') {
        const parent = targetElement.parentNode.parentNode.parentNode;
        parent.classList.add('test');
        document.addEventListener('mouseout', () => {
            parent.classList.remove('test');
        });
    }
    if (targetElement.dataset.name === 'card' && !gameMode) {
        const audio = targetElement.parentNode.children[0];
        audio.play();
        createStatistics('train');
    }
    if (targetElement.innerHTML === 'Repeat') {
        targetElement.parentNode.children[1].play();
    }
    if (targetElement.innerHTML === 'Start game') {
        const index = getRandomInt();
        const audio = document.createElement('audio');
        audio.setAttribute('src', `${cards[indexOfCategory][index].audioSrc}`);
        if (targetElement.parentNode.children[1]) {
            targetElement.parentNode.removeChild(targetElement.parentNode.children[1]);
        }
        targetElement.parentNode.appendChild(audio).play();
        targetElement.innerText = 'Repeat';
        targetElement.classList.add('new-game-container__repeat-button');
    }
    if (gameMode && targetElement.dataset.name === 'card') {
        const audioImage = targetElement.parentNode.children[0];
        if (gameButton.children[1]) {
            const audioGame = gameButton.children[1];
            if (targetElement.dataset.active === 'no') {
                if (audioGame.getAttribute('src') === audioImage.getAttribute('src')) {
                    document.querySelector('.correct-audio').play();
                    const link = document.createElement('span');
                    link.innerHTML = '<img src="./src/img/star-win.svg" alt="star">';
                    document.querySelector('.rating-menu').prepend(link);
                    targetElement.dataset.active = 'yes';
                    targetElement.classList.add('active-card');
                    createStatistics('game-success');
                    if (newArray.length !== 0) {
                        setTimeout(() => {
                            const index = getRandomInt();
                            const audio = document.createElement('audio');
                            audio.setAttribute('src', `${cards[indexOfCategory][index].audioSrc}`);
                            if (gameButton.children[1]) {
                                gameButton.removeChild(gameButton.children[1]);
                            }
                            gameButton.appendChild(audio).play();
                        }, 100);
                    } else if (errors !== 0) {
                        document.querySelector('.failure-audio').play();
                        document.querySelector('.finish_container__failure').classList.add('finish_container__active');
                        const textElement = document.createElement('span');
                        textElement.innerHTML = errors;
                        document.querySelector('.finish_container__failure').children[0].prepend(textElement);
                        setTimeout(() => {
                            document.querySelector('.finish_container__failure').classList.remove('finish_container__active');
                        }, 4700);
                        setTimeout(() => {
                            clearWindow();
                        }, 4700);
                        goToMainMenu();
                    } else {
                        document.querySelector('.success-audio').play();
                        document.querySelector('.finish_container__success').classList.add('finish_container__active');
                        setTimeout(() => {
                            document.querySelector('.finish_container__success').classList.remove('finish_container__active');
                        }, 4700);
                        clearWindow();
                        goToMainMenu();
                    }
                } else {
                    document.querySelector('.error-audio').play();
                    errors += 1;
                    const link = document.createElement('span');
                    link.innerHTML = '<img src="./src/img/star.svg" alt="star">';
                    document.querySelector('.rating-menu').prepend(link);
                    createStatistics('game-error');
                }
            }
        }
    }
});
